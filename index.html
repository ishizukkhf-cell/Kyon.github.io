<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ååˆºã‚¹ã‚­ãƒ£ãƒ³</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <style>
        /* ã‚¹ã‚¿ã‚¤ãƒ«ã¯å‰å›ã®ã¾ã¾ç¶­æŒ */
        :root { --primary: #2563eb; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --danger: #ef4444; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 120px; user-select: none; -webkit-user-select: none; }
        
        .dock { position: sticky; top: 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 12px; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; gap: 10px; justify-content: center; }
        .dock-btn { flex: 1; border: none; padding: 12px; border-radius: 30px; font-weight: bold; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; max-width: 160px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-cam { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .btn-file { background: linear-gradient(135deg, #64748b, #475569); }

        #editor-container { display: none; position: relative; background: #000; width: 100vw; height: 60vh; overflow: hidden; margin-bottom: 10px; }
        #source-image { width: 100%; height: 100%; object-fit: contain; }
        .crop-box { position: absolute; border: 2px solid #22c55e; background: rgba(34, 197, 94, 0.15); box-sizing: border-box; touch-action: none; }
        .handle { position: absolute; width: 24px; height: 24px; background: white; border: 2px solid #22c55e; border-radius: 50%; bottom: -12px; right: -12px; z-index: 10; }
        .btn-del-box { position: absolute; top: -12px; left: -12px; width: 24px; height: 24px; background: #ef4444; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-size: 14px; font-weight: bold; cursor: pointer; z-index: 10; }

        #actions { display: none; padding: 0 15px 15px; gap: 10px; }
        .btn-act { flex: 1; padding: 14px; border-radius: 12px; border: none; font-weight: bold; font-size: 15px; cursor: pointer; }
        .btn-retry { background: #e2e8f0; color: #475569; }
        .btn-ok { background: #22c55e; color: white; }

        #list-area { padding: 15px; max-width: 600px; margin: 0 auto; }
        .group-card { background: var(--card); border-radius: 16px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        .group-header { background: #f8fafc; padding: 12px 20px; font-weight: bold; color: #334155; display: flex; justify-content: space-between; border-bottom: 1px solid #e2e8f0; }
        
        .biz-card { padding: 20px; border-bottom: 1px solid #f1f5f9; position: relative; }
        .biz-card:last-child { border-bottom: none; }
        
        .card-footer { display: flex; justify-content: flex-end; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #f1f5f9; }
        .btn-delete { background: #fff; color: #94a3b8; border: 1px solid #e2e8f0; border-radius: 6px; padding: 6px 12px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 4px; }
        .btn-delete:hover { background: #fee2e2; color: #ef4444; border-color: #fecaca; }

        .field-row { display: flex; align-items: center; margin-bottom: 12px; gap: 10px; }
        .icon-link { width: 32px; height: 32px; border-radius: 8px; background: #f8fafc; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 16px; color: #cbd5e1; flex-shrink: 0; border: 1px solid #e2e8f0; }
        .icon-link.active { background: #eff6ff; color: #2563eb; border-color: #bfdbfe; }
        .icon-static { width: 32px; text-align: center; font-size: 16px; color: #64748b; flex-shrink: 0; }
        
        .input-wrap { flex: 1; display: flex; align-items: center; position: relative; border-bottom: 1px solid #e2e8f0; }
        .input-wrap:focus-within { border-bottom-color: #2563eb; }
        input { flex: 1; border: none; padding: 8px 0; font-size: 15px; color: #334155; background: transparent; border-radius: 0; outline: none; }
        
        .btn-suggest { padding: 8px; color: #94a3b8; cursor: pointer; font-size: 16px; }
        .badge { font-size: 11px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; background: #f1f5f9; color: #64748b; font-weight: bold; flex-shrink: 0; border: 1px solid #e2e8f0; }
        
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        #modal-content { background: white; width: 90%; max-height: 80%; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
        #modal-header { padding: 15px; border-bottom: 1px solid #eee; font-weight: bold; display: flex; justify-content: space-between; background: #f8fafc; }
        #modal-list { overflow-y: auto; padding: 0; }
        .candidate-item { padding: 15px; border-bottom: 1px solid #f1f5f9; cursor: pointer; color: #334155; }
        .candidate-item:active { background: #f0f9ff; color: #2563eb; }
        
        #btn-reset { display: block; margin: 40px auto; padding: 12px 24px; background: transparent; border: 1px solid #cbd5e1; color: #64748b; border-radius: 50px; cursor: pointer; font-size: 13px; font-weight: bold; }
    </style>
</head>
<body>

<div class="dock">
    <input type="file" id="inp-cam" accept="image/*" capture="environment" style="display:none">
    <button class="dock-btn btn-cam" onclick="document.getElementById('inp-cam').click()">ğŸ“· ã‚«ãƒ¡ãƒ©</button>
    <input type="file" id="inp-file" accept="image/*" style="display:none">
    <button class="dock-btn btn-file" onclick="document.getElementById('inp-file').click()">ğŸ“‚ ã‚¢ãƒ«ãƒãƒ </button>
</div>

<div id="editor-container">
    <img id="source-image">
</div>
<div id="actions">
    <button class="btn-act btn-retry" onclick="resetUI()">æ’®ã‚Šç›´ã—</button>
    <button class="btn-act btn-ok" id="btn-analyze">ã“ã®æ ã§è§£æ</button>
</div>

<div id="status-msg" style="text-align:center; padding:15px; color:#64748b; font-size:13px;"></div>
<div id="list-area"></div>

<button id="btn-reset" onclick="clearData()">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button>

<div id="modal-overlay">
    <div id="modal-content">
        <div id="modal-header">
            <span>æ–‡å­—å€™è£œã®é¸æŠ</span>
            <span onclick="closeModal()" style="cursor:pointer; color:#ef4444;">âœ•</span>
        </div>
        <div id="modal-list"></div>
    </div>
</div>

<script>
    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW registered!', reg))
                .catch(err => console.log('SW failed', err));
        });
    }

    const GAS_API = "https://script.google.com/macros/s/AKfycby9zNdPbf1FI6hpqx-nB6HX6a0QPpLAl1VCjo2zixOYfEtnmntpVP3uwAFOmW6fK7pKnw/exec";
    
    let cardDataList = [];
    const imgEl = document.getElementById('source-image');
    let editingCardId = null;
    let editingField = null;

    window.addEventListener('DOMContentLoaded', () => {
        const saved = localStorage.getItem('bizCardDB_v4');
        if (saved) {
            try { cardDataList = JSON.parse(saved); } catch(e) { cardDataList = []; }
            renderList();
        }
    });

    function saveData() {
        localStorage.setItem('bizCardDB_v4', JSON.stringify(cardDataList));
        renderList();
    }

    window.removeCard = function(id) {
        if (!confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        cardDataList = cardDataList.filter(c => c.id !== id);
        saveData();
    };

    window.clearData = function() {
        if (!confirm("å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        cardDataList = [];
        localStorage.removeItem('bizCardDB_v4');
        renderList();
    };
    
    window.updateField = function(id, field, value) {
        const card = cardDataList.find(c => c.id === id);
        if(card) {
            card[field] = value;
            localStorage.setItem('bizCardDB_v4', JSON.stringify(cardDataList));
        }
    };

    window.openCandidate = function(id, field) {
        const card = cardDataList.find(c => c.id === id);
        if(!card || !card.rawLines) return alert("å€™è£œãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
        
        editingCardId = id; editingField = field;
        const list = document.getElementById('modal-list');
        list.innerHTML = "";
        
        const cleanCandidates = card.rawLines.filter(line => {
            if(line.length < 2) return false;
            if(line.match(/^[0-9!-/:-@[-`{-~]*$/)) return false; 
            if(line.match(/FAX|Fax|URL|http/i)) return false; 
            return true;
        });

        cleanCandidates.forEach(line => {
            const div = document.createElement('div');
            div.className = 'candidate-item';
            div.innerText = line;
            div.onclick = () => selectCandidate(line);
            list.appendChild(div);
        });
        
        if(cleanCandidates.length === 0) list.innerHTML = "<div style='padding:15px; color:#aaa; text-align:center'>å€™è£œãŒã‚ã‚Šã¾ã›ã‚“</div>";
        document.getElementById('modal-overlay').style.display = 'flex';
    };
    
    function selectCandidate(text) {
        if(editingCardId && editingField) {
            const card = cardDataList.find(c => c.id === editingCardId);
            if(card) { card[editingField] = text; saveData(); }
        }
        closeModal();
    }
    window.closeModal = function() {
        document.getElementById('modal-overlay').style.display = 'none';
        editingCardId = null; editingField = null;
    };

    const handleInput = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        document.getElementById('status-msg').innerText = "ğŸ” è§£æä¸­...";
        document.getElementById('editor-container').style.display = 'block';
        document.getElementById('actions').style.display = 'none';
        
        const reader = new FileReader();
        reader.onload = (ev) => {
            imgEl.src = ev.target.result;
            imgEl.onload = () => {
                autoDetectBlobs();
                document.getElementById('actions').style.display = 'flex';
                document.getElementById('status-msg').innerText = "æ ã‚’ç¢ºèªã—ã¦ãã ã•ã„";
                document.getElementById('editor-container').scrollIntoView({behavior: "smooth"});
            };
        };
        reader.readAsDataURL(file);
        e.target.value = ''; 
    };
    document.getElementById('inp-cam').onchange = handleInput;
    document.getElementById('inp-file').onchange = handleInput;

    function resetUI() {
        document.getElementById('editor-container').style.display = 'none';
        document.getElementById('actions').style.display = 'none';
        document.getElementById('status-msg').innerText = "";
    }

    function autoDetectBlobs() {
        document.querySelectorAll('.crop-box').forEach(e => e.remove());
        const rect = getRenderedSize(imgEl);
        const cvs = document.createElement('canvas');
        const w=150; const h=Math.floor(imgEl.naturalHeight*(w/imgEl.naturalWidth));
        cvs.width=w; cvs.height=h;
        const ctx=cvs.getContext('2d');
        ctx.drawImage(imgEl,0,0,w,h);
        const data=ctx.getImageData(0,0,w,h).data;
        const grid=new Int8Array(w*h).fill(0);
        for(let i=0;i<data.length;i+=4) if((data[i]+data[i+1]+data[i+2])/3>90) grid[i/4]=1;
        const eroded=new Int8Array(w*h).fill(0);
        for(let y=1;y<h-1;y++){for(let x=1;x<w-1;x++){const idx=y*w+x;if(grid[idx]===1){if(grid[idx-1]===0||grid[idx+1]===0||grid[idx-w]===0||grid[idx+w]===0)eroded[idx]=0;else eroded[idx]=1;}}}
        const labels=new Int32Array(w*h).fill(0);
        let labelId=1; const boxes={};
        for(let y=0;y<h;y++){for(let x=0;x<w;x++){const idx=y*w+x;if(eroded[idx]===1&&labels[idx]===0){const stack=[idx];labels[idx]=labelId;let minX=x,maxX=x,minY=y,maxY=y,count=0;while(stack.length){const c=stack.pop();const cx=c%w;const cy=Math.floor(c/w);count++;if(cx<minX)minX=cx;if(cx>maxX)maxX=cx;if(cy<minY)minY=cy;if(cy>maxY)maxY=cy;[c-1,c+1,c-w,c+w].forEach(n=>{if(n>=0&&n<w*h&&eroded[n]===1&&labels[n]===0){labels[n]=labelId;stack.push(n);}});}boxes[labelId]={minX,maxX,minY,maxY,count};labelId++;}}}
        let found=0;
        Object.values(boxes).forEach(b=>{
            if(b.count>(w*h)*0.015){
                const l=(b.minX/w)*rect.width+rect.left; const t=(b.minY/h)*rect.height+rect.top;
                const bw=((b.maxX-b.minX)/w)*rect.width; const bh=((b.maxY-b.minY)/h)*rect.height;
                createBox(l-5,t-5,bw+10,bh+10); found++;
            }
        });
        if(found===0) createBox(rect.left+rect.width*0.1, rect.top+rect.height*0.2, rect.width*0.8, rect.height*0.6);
    }

    function getRenderedSize(img) {
        const r=img.naturalWidth/img.naturalHeight; const cr=img.clientWidth/img.clientHeight;
        let w,h,l,t; if(r>cr){w=img.clientWidth;h=w/r;l=0;t=(img.clientHeight-h)/2;}else{h=img.clientHeight;w=h*r;t=0;l=(img.clientWidth-w)/2;}
        return {width:w,height:h,left:l,top:t};
    }

    function createBox(l,t,w,h) {
        const b=document.createElement('div'); b.className='crop-box';
        b.style.left=l+'px'; b.style.top=t+'px'; b.style.width=w+'px'; b.style.height=h+'px';
        const btn=document.createElement('div'); btn.className='btn-del-box'; btn.innerText='Ã—';
        btn.onclick=(e)=>{e.stopPropagation();b.remove();};
        const hdl=document.createElement('div'); hdl.className='handle';
        b.appendChild(btn); b.appendChild(hdl);
        let drag=false,rsz=false,sx,sy,sw,sh,sl,st;
        const start=(e)=>{e.stopPropagation();const tc=e.touches[0];sx=tc.clientX;sy=tc.clientY;sw=b.offsetWidth;sh=b.offsetHeight;sl=b.offsetLeft;st=b.offsetTop;if(e.target===hdl)rsz=true;else drag=true;};
        const move=(e)=>{if(!drag&&!rsz)return;e.preventDefault();const tc=e.touches[0];const dx=tc.clientX-sx;const dy=tc.clientY-sy;if(rsz){b.style.width=(sw+dx)+'px';b.style.height=(sh+dy)+'px';}else{b.style.left=(sl+dx)+'px';b.style.top=(st+dy)+'px';}};
        b.addEventListener('touchstart',start); window.addEventListener('touchmove',move,{passive:false}); window.addEventListener('touchend',()=>{drag=false;rsz=false;});
        document.getElementById('editor-container').appendChild(b);
    }

    document.getElementById('btn-analyze').onclick = async () => {
        const boxes = document.querySelectorAll('.crop-box');
        if (boxes.length === 0) return alert("æ ãŒã‚ã‚Šã¾ã›ã‚“");
        document.getElementById('status-msg').innerText = "ğŸš€ OCRã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ä¸­...";
        const promises = Array.from(boxes).map(processBox);
        resetUI(); 
        await Promise.all(promises);
        document.getElementById('status-msg').innerText = "âœ… å®Œäº†ã—ã¾ã—ãŸ";
    };

    async function processBox(box) {
        const rect = box.getBoundingClientRect();
        const editorRect = document.getElementById('editor-container').getBoundingClientRect();
        const render = getRenderedSize(imgEl);
        const boxRelX = rect.left - editorRect.left; const boxRelY = rect.top - editorRect.top;
        const imgX = boxRelX - render.left; const imgY = boxRelY - render.top;
        const scale = imgEl.naturalWidth / render.width;
        
        const cvs = document.createElement('canvas');
        cvs.width = rect.width * scale; cvs.height = rect.height * scale;
        const ctx = cvs.getContext('2d');
        ctx.filter = "contrast(1.2) brightness(1.05)";
        ctx.drawImage(imgEl, imgX*scale, imgY*scale, rect.width*scale, rect.height*scale, 0,0,cvs.width,cvs.height);
        
        try {
            const base64 = cvs.toDataURL('image/jpeg', 0.9).split(',')[1];
            const res = await fetch(GAS_API, { method: 'POST', body: JSON.stringify({ image: base64, mimeType: "image/jpeg" }) });
            const json = await res.json();
            if (json.text) {
                const parsed = parseTextLogic(json.text);
                parsed.id = Date.now() + Math.random();
                cardDataList.unshift(parsed);
                saveData();
            }
        } catch(e) { console.error(e); }
    }

    function parseTextLogic(text) {
        const norm = text.replace(/[ï¼-ï¼™]/g,s=>String.fromCharCode(s.charCodeAt(0)-0xFEE0)).replace(/[ãƒ¼ï¼â€•â€]/g,'-').replace(/[ï¼ˆï¼‰()]/g,' ').replace(/[:]/g,' ').trim();
        let lines = norm.split('\n').map(l=>l.trim()).filter(l=>l.length>0);
        
        const jobTitles = ["ä»£è¡¨","ç¤¾é•·","å–ç· å½¹","åŸ·è¡Œå½¹å“¡","æœ¬éƒ¨é•·","éƒ¨é•·","æ¬¡é•·","èª²é•·","ä¿‚é•·","ä¸»ä»»","ä¸»å‹™","ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼","ãƒªãƒ¼ãƒ€ãƒ¼","CEO","COO","CFO","CTO"];
        const regSplit = new RegExp(`^(${jobTitles.join('|')})[\\sã€€]*([^\\sã€€].+)$`);
        
        let splitLines = [];
        lines.forEach(l => {
            const match = l.match(regSplit);
            if(match) {
                splitLines.push(match[1]); 
                splitLines.push(match[2]); 
            } else {
                splitLines.push(l);
            }
        });
        lines = splitLines;

        let d = { name:"", company:"", dept:"", title:"", address:"", tel:"", mobile:"", email:"", rawLines: lines };
        
        const reEmail = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/;
        const rePhoneLoose = /0\s*[\d\s-]{9,}/; 
        const reMobile = /^(090|080|070)/;
        const reZip = /ã€’|^\d{3}-\d{4}/;
        const reCo = /(æ ªå¼ä¼šç¤¾|æœ‰é™ä¼šç¤¾|åˆåŒä¼šç¤¾|Corp|Inc|Ltd)/i;
        const reTitle = new RegExp(`(${jobTitles.join('|')})`);
        const reDept = /(éƒ¨|èª²|å®¤|ãƒãƒ¼ãƒ |ã‚°ãƒ«ãƒ¼ãƒ—|ã‚»ãƒ³ã‚¿ãƒ¼|æ”¯åº—|å–¶æ¥­æ‰€)/;
        const reAddrKeywords = /(éƒ½|é“|åºœ|çœŒ|å¸‚|åŒº|ç”º|æ‘)/;
        const MAX_NAME_LEN = 12; 

        let cleanLines = [...lines];
        
        cleanLines.forEach((l, i) => {
            if(l.match(/FAX|Fax|ãƒ•ã‚¡ãƒƒã‚¯ã‚¹/i)) { cleanLines[i] = ""; return; }
            if(l.match(reEmail)) { d.email = l.match(reEmail)[0]; if(!l.match(reCo)) cleanLines[i]=""; }
            
            const looseMatch = l.match(rePhoneLoose);
            if(looseMatch) {
                const rawNum = looseMatch[0];
                const cleanNum = rawNum.replace(/[\s]/g, ''); 
                
                if(cleanNum.replace(/-/g,'').length >= 10) {
                    if (reMobile.test(cleanNum.replace(/-/g,''))) d.mobile = cleanNum; 
                    else d.tel = cleanNum;
                    
                    cleanLines[i] = l.replace(rawNum, '').trim(); 
                }
            }
        });

        cleanLines.forEach(l => {
            if(l.length < 2) return;
            if(l.match(reZip) || (l.match(reAddrKeywords) && l.match(/\d/))) {
                if(l.length > d.address.length) d.address = l; return;
            }
            if(l.match(reCo)) { d.company = l; return; }
            if(l.match(reTitle)) { d.title = l; return; }
            if(l.match(reDept)) { d.dept = l; return; }
            
            if (!d.name && !l.match(/URL|http|ã€’/) && !l.match(/\d/)) {
                const hasJa = l.match(/[ã-ã‚“ã‚¡-ãƒ¶ä¸€-é¾ ]/);
                if (hasJa && l.length <= MAX_NAME_LEN) {
                    if (l.match(/\s/) || l.match(/^[ä¸€-é¾ ]{2,6}$/)) { d.name = l.replace(/\s/g,' '); } 
                    else if(l.length >= 2 && l.length <= 8) { d.name = l; }
                }
            }
        });
        if (!d.name) d.name = "ï¼ˆåå‰ä¸æ˜ï¼‰";
        if (!d.company) d.company = "ï¼ˆä¼šç¤¾åä¸æ˜ï¼‰";
        return d;
    }

    function renderList() {
        const area = document.getElementById('list-area');
        area.innerHTML = "";
        const groups = {};
        cardDataList.forEach(c => {
            const k = c.company || "æœªåˆ†é¡";
            if(!groups[k]) groups[k] = [];
            groups[k].push(c);
        });

        Object.keys(groups).forEach(co => {
            const grp = document.createElement('div'); grp.className = 'group-card';
            grp.innerHTML = `<div class="group-header">ğŸ¢ ${co} <span style="font-size:0.8em; color:#94a3b8">(${groups[co].length})</span></div>`;
            
            groups[co].forEach(c => {
                const row = document.createElement('div'); row.className = 'biz-card';
                
                const getLink = (type, val) => {
                    if(!val) return `<span class="icon-link"></span>`;
                    let cleanVal = val.replace(/[\s-]/g, ''); 
                    let href = type==='tel' ? `tel:${cleanVal}` : type==='mail' ? `mailto:${val}` : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(val)}`;
                    let icon = type==='tel' ? (cleanVal.startsWith('090')||cleanVal.startsWith('080')?'ğŸ“±':'ğŸ“') : type==='mail' ? 'ğŸ“§' : 'ğŸ“';
                    return `<a href="${href}" class="icon-link active" target="${type==='map'?'_blank':''}">${icon}</a>`;
                };

                const createInput = (key, val, icon) => `
                    <div class="field-row">
                        ${icon.startsWith('<') ? icon : `<span class="icon-static">${icon}</span>`}
                        <div class="input-wrap">
                            <input value="${val||''}" onchange="updateField(${c.id}, '${key}', this.value)" placeholder="${key}">
                            <span class="btn-suggest" onclick="openCandidate(${c.id}, '${key}')">ğŸ“</span>
                        </div>
                    </div>`;

                row.innerHTML = `
                    ${createInput('name', c.name, 'ğŸ‘¤')}
                    
                    <div class="field-row">
                        <span class="badge">éƒ¨ç½²</span>
                        <div class="input-wrap">
                            <input value="${c.dept}" onchange="updateField(${c.id},'dept',this.value)">
                            <span class="btn-suggest" onclick="openCandidate(${c.id}, 'dept')">ğŸ“</span>
                        </div>
                    </div>
                    <div class="field-row">
                        <span class="badge bg-pos">å½¹è·</span>
                        <div class="input-wrap">
                            <input value="${c.title}" onchange="updateField(${c.id},'title',this.value)">
                            <span class="btn-suggest" onclick="openCandidate(${c.id}, 'title')">ğŸ“</span>
                        </div>
                    </div>

                    ${createInput('address', c.address, getLink('map', c.address))}
                    ${createInput('tel', c.tel, getLink('tel', c.tel))}
                    ${createInput('mobile', c.mobile, getLink('tel', c.mobile))}
                    ${createInput('email', c.email, getLink('mail', c.email))}
                    
                    <div class="card-footer">
                        <button class="btn-delete" onclick="removeCard(${c.id})">ğŸ—‘ï¸ å‰Šé™¤</button>
                    </div>
                `;
                grp.appendChild(row);
            });
            area.appendChild(grp);
        });
    }
</script>
</body>
</html>